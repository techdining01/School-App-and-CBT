<h2>Review: {{ quiz.title }}</h2>
<p>Attempt Score: <span id="score-box">{{ attempt.score }}</span></p>

{% for a in answers %}
  <div>
    <p><b>{{ forloop.counter }}. {{ a.question.text }}</b></p>
    <p>Your Response: {{ a.response }}</p>
    {% if a.is_subjective %}
      <p>Status: <span id="ans-{{ forloop.counter0 }}">
        {% if a.graded %} Graded ({{ a.obtained_marks }} pts)
        {% else %} Pending grading {% endif %}
      </span></p>
    {% else %}
      <p>Marks: {{ a.obtained_marks }}</p>
    {% endif %}
  </div>
  <hr>
{% endfor %}

<script>
function refreshReview() {
  fetch("{% url 'api_review_status' quiz.id %}")
    .then(res => res.json())
    .then(data => {
      document.getElementById("score-box").innerText = data.score;
      data.answers.forEach((item, i) => {
        let el = document.getElementById("ans-" + i);
        if (el && item.is_subjective) {
          el.innerText = item.graded ? `Graded (${item.marks} pts)` : "Pending grading";
        }
      });
    });
}
setInterval(refreshReview, 15000);
</script>
