{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <h2>📚 Teacher Dashboard</h2>

  <!-- Quizzes -->
  <div class="card mb-4">
    <div class="card-header">📝 My Quizzes</div>
    <div class="card-body">
      <ul class="list-group">
        {% for quiz in quizzes %}
          <li class="list-group-item d-flex justify-content-between">
            {{ quiz.title }} 
            <a href="{% url 'download_class_report' quiz.id %}" class="btn btn-sm btn-success">⬇ Class Report</a>
          </li>
        {% empty %}
          <li class="list-group-item">No quizzes yet.</li>
        {% endfor %}
      </ul>
      <div class="mt-2">
        {% if quizzes.has_previous %}
          <a href="?quiz_page={{ quizzes.previous_page_number }}" class="btn btn-outline-secondary btn-sm">Prev</a>
        {% endif %}
        {% if quizzes.has_next %}
          <a href="?quiz_page={{ quizzes.next_page_number }}" class="btn btn-outline-secondary btn-sm">Next</a>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Student Attempts -->
  <div class="card mb-4">
    <div class="card-header">📊 Student Attempts</div>
    <div class="card-body">
      <ul class="list-group">
        {% for a in attempts %}
          <li class="list-group-item">
            {{ a.student.username }} — {{ a.quiz.title }}
            <span class="badge bg-info">Score: {{ a.score }}</span>
            <a href="{% url 'review_student_attempt' a.id %}" class="btn btn-sm btn-primary">Review</a>
            <a href="{% url 'download_student_report' a.student.id %}" class="btn btn-sm btn-success">⬇ Report</a>
          </li>
        {% empty %}
          <li class="list-group-item">No attempts yet.</li>
        {% endfor %}
      </ul>
      <div class="mt-2">
        {% if attempts.has_previous %}
          <a href="?attempt_page={{ attempts.previous_page_number }}" class="btn btn-outline-secondary btn-sm">Prev</a>
        {% endif %}
        {% if attempts.has_next %}
          <a href="?attempt_page={{ attempts.next_page_number }}" class="btn btn-outline-secondary btn-sm">Next</a>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Class Performance -->
  <div class="card mb-4">
    <div class="card-header">📈 Class Performance</div>
    <div class="card-body">
      <ul class="list-group">
        {% for perf in class_performance %}
          <li class="list-group-item d-flex justify-content-between">
            {{ perf.student__username }}
            <span class="badge bg-primary">Avg: {{ perf.avg_score|floatformat:2 }}</span>
          </li>
        {% empty %}
          <li class="list-group-item">No performance data yet.</li>
        {% endfor %}
      </ul>
    </div>
  </div>
</div>
{% endblock %}
