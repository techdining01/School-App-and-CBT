{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-3">üéì Student Dashboard</h2>

<!-- Notifications -->
    <h5>üì© Notifications</h5>
        <ul class="list-group mb-3">
            {% for notif in notifications %}
                <li class="list-group-item d-flex justify-content-between align-items-center
                        {% if not notif.is_read %}list-group-item-warning{% endif %}">
                {{ notif.message }}
                <small class="text-muted">{{ notif.created_at|date:"M d, H:i" }}</small>

                {% if not notif.is_read %}
                    <a href="{% url 'mark_notification_read' notif.id %}" 
                    class="btn btn-sm btn-outline-success">Mark as read</a>
                {% endif %}
                </li>
            {% empty %}
                <li class="list-group-item">No notifications yet.</li>
            {% endfor %}
        </ul>
    </div>


    <!-- Summary -->
    <div class="card mb-4">
        <div class="card-header">üìä Summary</div>
        <div class="card-body">
            <p>Total Quizzes Attempted: {{ total_attempts }}</p>
            <p>Objective Results: {{ auto_graded_count }}</p>
            <p>Pending Subjectives: {{ pending_subjectives }}</p>
        </div>
    </div>

    <!-- Available Quizzes -->
    <div class="card mb-4">
        <div class="card-header">üìù Available Quizzes</div>
        <div class="card-body">
            <ul class="list-group">
                {% for quiz in available_quizzes %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        {{ quiz.title }}
                        <a href="{% url 'take_quiz' quiz.id %}" class="btn btn-sm btn-primary">Take Quiz</a>
                    </li>
                {% empty %}
                    <li class="list-group-item">No quizzes available.</li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <!-- Results Review -->
    <div class="card mb-4">
        <div class="card-header">üìñ Review Wrong Answers</div>
        <div class="card-body">
            {% for attempt in quiz_attempts %}
                <h6>{{ attempt.quiz.title }}</h6>
                <ul>
                    {% for wrong in attempt.wrong_answers %}
                        <li>Q: {{ wrong.question.text }} <br>
                            <strong>Your Answer:</strong> {{ wrong.your_answer }} <br>
                            <strong>Correct Answer:</strong> {{ wrong.correct_answer }}
                        </li>
                    {% endfor %}
                </ul>
            {% empty %}
                <p>No attempts yet.</p>
            {% endfor %}
        </div>
    </div>

    <!-- Consolidated Results -->
    <a href="{% url 'export_consolidated_pdf' %}" class="btn btn-success">
        üì• Download Consolidated Results (PDF)
    </a>
</div>
{% endblock %}
